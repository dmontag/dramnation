<html>
<head>
    <style>
body {
    background: url(bg2.jpg) no-repeat center center fixed; 
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
}

.heading {
    position: absolute;
    left: 30px;
    top: 80%;
    color: white;
    font-family: "Lucida Console", Monaco, monospace;
}

.heading h1 {
    font-size: 2.5em; 
}

.console {
    position: absolute;
    left: 40%;
    bottom: 0%;
    color: white;
    font-family: "Lucida Console", Monaco, monospace;
    font-size: 12;
    width:55%;
}

#query {
    width: 100%;
}

#result {
    /*height: 70%;*/
    /*width: 100%;*/
    /*overflow: auto;*/
}

.DistilleryName {
    color: hotpink;
}

.WhiskyName {
    color: gold;
}

.BottlerName {
    color: greenyellow;
}

.RegionName {
    color: deepskyblue;
}

.id {
    color:#bbb;
}


.DivToScroll{   
    /*font-size: 12px;*/
    /*font-weight: bold;*/
}

.DivWithScroll{
    height:300px;
    overflow:auto;
    overflow-x:hidden;
}

    </style>
    <script src="jquery-2.1.1.js"></script>
    <script>
        $(document).ready(function() {
            $("#query").keypress(function (e) {
                if (e.which == '13') {
                    $("#result").html("");
                    var query = $("#query")[0].value;
                    $.post("/app", {query: query}, renderResult);
                }
            });
        });

        function renderResult(result, status, xhr) {
            console.log(result);
            var html;
            if (result.error) {
                html = JSON.stringify(result.error);
            } else if (result.result) {
                var data = result.result.map(function(d) { var r = d["result"]; r["item"] = r["item"]["_data"]["data"]; return r; });
                html = data.map(renderEntry).join("<br/>");
            }
            $("#result").html(html);
        }

        function renderEntry(entry) {
            
            console.log(entry);
            var result = "";
            if (entry.kind == "Whisky") {
                result = "<span class='id'>" + entry.item.id + "</span> <strong><span class='WhiskyName'>" + entry.item.displayName + "</span></strong> ";
                result += renderWhiskyModifiers(entry);
            } else if (entry.kind == "Distillery") {
                result = "<strong><span class='DistilleryName'>" + entry.item.displayName + "</span></strong> ";
                result += renderDistilleryModifiers(entry);
            } else {
                result = "<strong><span class='" + entry.kind + "Name'>" + entry.item.displayName + "</span></strong> ";
                delete entry.item.name;
                delete entry.item.displayName;
                result += Object.keys(entry.item).map(function (k) {
                    var v = entry.item[k];
                    return k + ": " + v;
                }).join(", ");
            }
            return result;
        }

        function renderWhiskyModifiers(entry) {
            var data = entry.item;
            var result = "";
            if (data.percentage) result += " " + data.percentage + "%";
            if (data.singleCask) result += " Single Cask";
            if (data.peated) result += " Peated";
            if (data.originalBottling) result += " OB";
            if (entry.bottler) result += " <span class='BottlerName'>" + props(entry.bottler).displayName + "</span>";
            return result;
        }

        function renderDistilleryModifiers(entry) {
            var result = "";
            if (entry.item.closed) result += " Closed";
            if (entry.region) result += " in <span class='RegionName'>" + props(entry.region).displayName + "</span>";
            return result;
        }

        function props(map) {
            return map["_data"]["data"];
        }
    </script>
</head>
<body>
    <div class="heading">
        <h1>Dramnation</h1>
        <p>
            Sponsored by Glenersta Whisky Society
        </p>
    </div>
    <div class="console">
        <div id="result" class="DivWithScroll DivToScroll"></div>
        <input id="query" type="text"/>
        <p>
            Examples:
            <ul>
                <li>list all (whisky|distilleries|bottlers|regions)</li>
                <li>(add|remove) (distillery|bottler|region) &lt;name&gt;</li>
                <li>add whisky &lt;definition&gt;</li>
                <li>remove whisky &lt;id&gt;</li>
                <li>(set|unset) (whisky|distillery) &lt;id|name&gt; &lt;modifier&gt;</li>
            </ul>
        </p>
    </div>
</body>
</html>